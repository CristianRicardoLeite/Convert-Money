class AwesomeApi{constructor(){this.baseUrl="https://economia.awesomeapi.com.br/json"}async makeRequest(resource){const endpoint=this.baseUrl+resource;const response=await fetch(endpoint);const data=await response.json();return data}async getCompleteListCombinations(){const resource="/available";const data=await this.makeRequest(resource);return data}async getCurrencyNameList(){const resource="/available/uniq";const data=await this.makeRequest(resource);return data}async getConversionRate(currencyTypeA,currencyTypeB){const resource=`/${currencyTypeA}-${currencyTypeB}`;console.log(resource);const data=await this.makeRequest(resource);return data}}class Currencyfreaks{constructor(){this.baseUrl="https://api.currencyfreaks.com/supported-currencies"}async supportedCurrencyInformation(){const response=await fetch(this.baseUrl);const data=await response.json();return data}}class CurrencyConverter{constructor(awesome,currencyfreaks){this.awesomeApi=awesome;this.currencyfreaksApi=currencyfreaks;this.convertingCurrencySelect=document.getElementById("converting-currency");this.selectCoinSelect=document.getElementById("select-coin");this.converterButton=document.getElementById("converter-button");this.conversionRate=0;this.loadInitialState();this.infoCurrency();document.addEventListener("input",event=>this.inputEventHandler(event));this.converterButton.addEventListener("click",()=>this.convert())}async loadInitialState(){this.updateConversionUI("BRL","Real Brasileiro","USD","DÃ³lar Americano");const currencyNameList=await this.awesomeApi.getCurrencyNameList();const availableOpt=await this.availableOptions();this.populateSelectWithOptions(this.convertingCurrencySelect,currencyNameList,Object.keys(availableOpt));this.convertingCurrencySelect.value="BRL";this.populateSelectWithOptions(this.selectCoinSelect,currencyNameList,availableOpt[this.convertingCurrencySelect.value]);this.selectCoinSelect.value="USD"}async inputEventHandler(event){const targetId=event.target.id;if(targetId==="valuesInput"){return}const{value:fromCurrency,textContent:fromCurrencyText}=this.convertingCurrencySelect.selectedOptions[0];if(targetId==="converting-currency"){await this.handleCurrencyChange()}const{value:toCurrency,textContent:toCurrencyText}=this.selectCoinSelect.selectedOptions[0];this.updateConversionUI(fromCurrency,fromCurrencyText,toCurrency,toCurrencyText)}async updateConversionUI(fromCurrency,fromCurrencyText,toCurrency,toCurrencyText){const fromIcon=await this.coinIconLink(fromCurrency);const toIcon=await this.coinIconLink(toCurrency);const covertFromFlag=document.getElementById("Converting-flag");const covertFromViewValue=document.getElementById("resultConverterView1");const covertFromViewText=document.getElementById("coinConverterView");covertFromFlag.src=fromIcon;covertFromViewText.innerHTML=fromCurrencyText;covertFromViewValue.innerHTML=0;const covertToFlag=document.getElementById("coinFlag");const convertToViewValue=document.getElementById("resultConvertedView2");const covertToViewText=document.getElementById("coinConvertedText");covertToFlag.src=toIcon;covertToViewText.innerHTML=toCurrencyText;convertToViewValue.innerHTML=0}async handleCurrencyChange(){const availableOpt=await this.availableOptions();const currencyNameList=await this.awesomeApi.getCurrencyNameList();this.removeAllOptions(this.selectCoinSelect);this.populateSelectWithOptions(this.selectCoinSelect,currencyNameList,availableOpt[this.convertingCurrencySelect.value])}async convert(){const covertFromViewValue=document.getElementById("resultConverterView1");const convertToViewValue=document.getElementById("resultConvertedView2");const{value:inputValue}=document.getElementById("valuesInput");const{value:fromCurrency}=this.convertingCurrencySelect.selectedOptions[0];const{value:toCurrency}=this.selectCoinSelect.selectedOptions[0];const conversionRateData=await this.awesomeApi.getConversionRate(fromCurrency,toCurrency);this.conversionRate=parseFloat(conversionRateData[0].high);const convertedValue=(inputValue*this.conversionRate).toFixed(2);covertFromViewValue.innerHTML=parseFloat(inputValue).toFixed(2);convertToViewValue.innerHTML=convertedValue}async infoCurrency(){const jsonData=await this.currencyfreaksApi.supportedCurrencyInformation();return jsonData}async coinIconLink(currencyCode){const infoCurrency=await this.infoCurrency();for(let index=0;index<Object.keys(infoCurrency).length;index++){if(infoCurrency[index]["currencyCode"]===currencyCode){return infoCurrency[index]["icon"]}}}async availableOptions(){const listCombinations=await this.awesomeApi.getCompleteListCombinations();const availableOpt={};for(const key of Object.keys(listCombinations)){const[opt,value]=key.split("-");if(!availableOpt[opt]){availableOpt[opt]=[]}availableOpt[opt].push(value)}return availableOpt}populateSelectWithOptions(select,arrayJson,arrayDef=[]){for(const[key,value]of Object.entries(arrayJson)){if(Array.isArray(arrayDef)&&arrayDef.length&&arrayDef.includes(key)){let optionCurrency=document.createElement("option");optionCurrency.value=key;optionCurrency.text=`${value}`;select.add(optionCurrency)}}}removeAllOptions(select){while(select.options.length>0){select.remove(0)}}}const InfoApi=new AwesomeApi;const imgApi=new Currencyfreaks;const converter=new CurrencyConverter(InfoApi,imgApi);
